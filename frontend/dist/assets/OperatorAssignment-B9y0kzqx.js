import{j as e}from"./query-B88w_-l3.js";import{r as i}from"./vendor-BKU87Gzz.js";import{u as R,J as w,L as z,o as q,Q as k,c as M}from"./index-DY2ZM4tI.js";import{F as v}from"./CheckIcon-DeOLvj_K.js";import"./router-Cr3qqr-L.js";import"./utils-CZH8StwO.js";const G=()=>{const{user:c}=R(),[u,S]=i.useState([]),[l,E]=i.useState([]),[x,O]=i.useState([]),[A,m]=i.useState(!0),[b,j]=i.useState(!1),[f,g]=i.useState(null),[I,L]=i.useState(null),[h,$]=i.useState(""),p=["ADMIN","MANAGER"].includes(c==null?void 0:c.role);i.useEffect(()=>{if(!p){g("Você não tem permissão para acessar esta página"),m(!1);return}y()},[p]);const y=async()=>{try{m(!0),g(null);const[a,r,t]=await Promise.all([fetch("/api/machines",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),fetch("/api/users?role=OPERATOR",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),fetch("/api/permissions",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})]);if(!a.ok||!r.ok||!t.ok)throw new Error("Erro ao carregar dados");const[d,s,n]=await Promise.all([a.json(),r.json(),t.json()]);S(d.data||[]),E(s.data||[]),O(n.data||[])}catch(a){console.error("Erro ao carregar dados:",a),g("Erro ao carregar dados. Tente novamente.")}finally{m(!1)}},C=async(a,r,t,d)=>{try{j(!0);const s=x.find(N=>N.userId===a&&N.machineId===r);let n;if(s?n=await fetch(`/api/permissions/${s.id}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({...s,[t]:d})}):n=await fetch("/api/permissions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("token")}`},body:JSON.stringify({userId:a,machineId:r,canView:t==="canView"?d:!1,canOperate:t==="canOperate"?d:!0,canEdit:t==="canEdit"?d:!1})}),!n.ok)throw new Error("Erro ao atualizar permissão");await y()}catch(s){console.error("Erro ao atualizar permissão:",s),alert("Erro ao atualizar permissão. Tente novamente.")}finally{j(!1)}},o=(a,r,t)=>{const d=x.find(s=>s.userId===a&&s.machineId===r);return d?d[t]:!1},P=u.filter(a=>{var r;return a.name.toLowerCase().includes(h.toLowerCase())||((r=a.location)==null?void 0:r.toLowerCase().includes(h.toLowerCase()))});return p?A?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:e.jsx(z,{size:"lg"})}):f?e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(w,{className:"h-16 w-16 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Erro"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:f}),e.jsx("button",{onClick:y,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Tentar Novamente"})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 dark:text-white mb-2",children:"Atribuição de Operadores"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Gerencie quais operadores podem acessar e operar cada máquina."})]}),e.jsx("div",{className:"mb-6",children:e.jsx("div",{className:"flex flex-col sm:flex-row gap-4",children:e.jsx("div",{className:"flex-1",children:e.jsx("input",{type:"text",placeholder:"Buscar máquinas...",value:h,onChange:a=>$(a.target.value),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})})})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(q,{className:"h-8 w-8 text-blue-500 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Total de Máquinas"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:u.length})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(k,{className:"h-8 w-8 text-green-500 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Operadores"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:l.length})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(v,{className:"h-8 w-8 text-purple-500 mr-3"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Permissões Ativas"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:x.length})]})]})})]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 overflow-hidden",children:[e.jsxs("div",{className:"px-6 py-4 border-b border-gray-200 dark:border-gray-700",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Matriz de Permissões"}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:"Clique nas células para alterar as permissões dos operadores."})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200 dark:divide-gray-700",children:[e.jsx("thead",{className:"bg-gray-50 dark:bg-gray-700",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:"Máquina"}),l.map(a=>e.jsx("th",{className:"px-3 py-3 text-center text-xs font-medium text-gray-500 dark:text-gray-300 uppercase tracking-wider",children:e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center text-white text-sm font-medium mb-1",children:a.name.split(" ").map(r=>r[0]).join("").substring(0,2)}),e.jsx("span",{className:"text-xs",children:a.name.split(" ")[0]})]})},a.id))]})}),e.jsx("tbody",{className:"bg-white dark:bg-gray-800 divide-y divide-gray-200 dark:divide-gray-700",children:P.map(a=>e.jsxs("tr",{className:"hover:bg-gray-50 dark:hover:bg-gray-700",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900 dark:text-white",children:a.name}),e.jsx("div",{className:"text-sm text-gray-500 dark:text-gray-400",children:a.location||"Localização não definida"})]})}),l.map(r=>e.jsx("td",{className:"px-3 py-4 text-center",children:e.jsx("button",{onClick:()=>C(r.id,a.id,"canOperate",!o(r.id,a.id,"canOperate")),disabled:b,className:M("w-8 h-8 rounded-full border-2 transition-all duration-200 hover:scale-110",o(r.id,a.id,"canOperate")?"bg-green-500 border-green-500 text-white":"bg-gray-100 dark:bg-gray-600 border-gray-300 dark:border-gray-500 text-gray-400 dark:text-gray-300",b&&"opacity-50 cursor-not-allowed"),title:`${o(r.id,a.id,"canOperate")?"Remover":"Conceder"} permissão de operação para ${r.name} na máquina ${a.name}`,children:o(r.id,a.id,"canOperate")&&e.jsx(v,{className:"h-4 w-4 mx-auto"})})},`${a.id}-${r.id}`))]},a.id))})]})})]}),e.jsxs("div",{className:"mt-6 bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsx("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-2",children:"Legenda:"}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-sm",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-4 h-4 bg-green-500 rounded-full mr-2"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Pode operar a máquina"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-4 h-4 bg-gray-300 dark:bg-gray-600 rounded-full mr-2"}),e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Não pode operar a máquina"})]})]})]}),l.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(k,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Nenhum operador encontrado"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Cadastre operadores no sistema para poder atribuí-los às máquinas."})]})]})}):e.jsx("div",{className:"min-h-screen bg-gray-50 dark:bg-gray-900 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(w,{className:"h-16 w-16 text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-900 dark:text-white mb-2",children:"Acesso Negado"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Você não tem permissão para acessar esta página."})]})})};export{G as default};
//# sourceMappingURL=OperatorAssignment-B9y0kzqx.js.map
