import{j as e}from"./query-B88w_-l3.js";import{r as a}from"./vendor-BKU87Gzz.js";import{u as re,L as S}from"./router-Cr3qqr-L.js";import{u as ae,f as te,W as de,H as O,m as $,e as L,R as M,n as P,O as I,l as q,G as le,c as u,q as oe,b as ne,z as ce,C as ie,p as xe}from"./index-DY2ZM4tI.js";import{F as H}from"./PlusIcon-Bk98C3yE.js";import{F as me}from"./PhotoIcon-DC7Da6Dm.js";import"./utils-CZH8StwO.js";const we=()=>{var F;const B=re(),[g,Q]=a.useState(""),[y,W]=a.useState("ALL"),[p,Y]=a.useState("ALL"),[j,z]=a.useState("TODAY"),[R,U]=a.useState("timestamp"),[f,G]=a.useState("desc"),[ge,he]=a.useState(null),[ue,be]=a.useState(!1),{user:n}=ae(),{isConnected:N}=te(),[b,K]=a.useState(((F=B.state)==null?void 0:F.message)||"");a.useEffect(()=>{if(b){const s=setTimeout(()=>K(""),5e3);return()=>clearTimeout(s)}},[b]);const[c,V]=a.useState([]),[Z,_]=a.useState([]),[T,C]=a.useState(!0),[v,D]=a.useState(null);a.useEffect(()=>{(async()=>{try{C(!0),D(null);const[r,d]=await Promise.all([fetch("/api/quality-tests",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}),fetch("/api/machines",{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}})]);if(!r.ok||!d.ok)throw new Error("Erro ao carregar dados");const[t,l]=await Promise.all([r.json(),d.json()]);t.success&&V(t.data||[]),l.success&&_(l.data||[])}catch(r){D("Erro ao carregar dados"),console.error("Erro ao carregar dados:",r)}finally{C(!1)}})()},[]);const k=c.filter(s=>{var h,E;const r=((h=s.machine)==null?void 0:h.name)||"",d=((E=s.user)==null?void 0:E.name)||"",t=s.product||"",l=s.lot||"",o=s.id.toString().toLowerCase().includes(g.toLowerCase())||r.toLowerCase().includes(g.toLowerCase())||d.toLowerCase().includes(g.toLowerCase())||t.toLowerCase().includes(g.toLowerCase())||l.toLowerCase().includes(g.toLowerCase()),i=y==="ALL"||(s.approved?"PASS":"FAIL")===y,x=p==="ALL"||s.machineId===p;let m=!0;if(j!=="ALL"){const w=new Date,A=new Date(s.testDate||s.createdAt);switch(j){case"TODAY":m=A.toDateString()===w.toDateString();break;case"WEEK":const ee=new Date(w.getTime()-7*24*60*60*1e3);m=A>=ee;break;case"MONTH":const se=new Date(w.getTime()-30*24*60*60*1e3);m=A>=se;break}}return o&&i&&x&&m}).sort((s,r)=>{var l,o,i,x;let d,t;switch(R){case"timestamp":d=new Date(s.testDate||s.createdAt),t=new Date(r.testDate||r.createdAt);break;case"machine":d=((l=s.machine)==null?void 0:l.name)||"",t=((o=r.machine)==null?void 0:o.name)||"";break;case"operator":d=((i=s.user)==null?void 0:i.name)||"",t=((x=r.user)==null?void 0:x.name)||"";break;case"result":d=s.overallResult,t=r.overallResult;break;default:return 0}return f==="asc"?d>t?1:-1:d<t?1:-1}),J=s=>{switch(s){case"PASS":return{label:"Aprovado",color:"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400",icon:L,iconColor:"text-green-600 dark:text-green-400"};case"FAIL":return{label:"Reprovado",color:"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400",icon:I,iconColor:"text-red-600 dark:text-red-400"};default:return{label:"Pendente",color:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-400",icon:xe,iconColor:"text-yellow-600 dark:text-yellow-400"}}},X=({test:s})=>{var i,x,m;const r=J(s.approved?"PASS":"FAIL"),d=r.icon,t=s.testResults||{},l=Object.values(t).filter(h=>h==="PASS").length,o=Object.values(t).filter(h=>h!==null).length;return e.jsxs($.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:u("p-2 rounded-lg",s.approved?"bg-green-100 dark:bg-green-900/20":s.approved?"bg-yellow-100 dark:bg-yellow-900/20":"bg-red-100 dark:bg-red-900/20"),children:e.jsx(d,{className:u("h-6 w-6",r.iconColor)})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:s.id}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[((i=s.machine)==null?void 0:i.name)||"N/A"," • ",((x=s.machine)==null?void 0:x.location)||""]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:u("inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",r.color),children:r.label}),s.defects&&s.defects.length>0&&e.jsxs("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-orange-100 text-orange-800 dark:bg-orange-900/20 dark:text-orange-400",children:[s.defects.length," defeitos"]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Operador"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:((m=s.user)==null?void 0:m.name)||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Produto"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:s.product||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Lote"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:s.lot||"N/A"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Caixa"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:s.boxNumber||"N/A"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400 mb-1",children:[e.jsx("span",{children:"Testes Realizados"}),e.jsxs("span",{children:[l,"/",o," aprovados"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:u("h-2 rounded-full transition-all duration-300",l===o?"bg-green-500":l>=o*.8?"bg-yellow-500":"bg-red-500"),style:{width:`${o>0?l/o*100:0}%`}})})]}),s.observations&&e.jsx("div",{className:"mb-4",children:e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 line-clamp-2",children:s.observations})}),e.jsx("div",{className:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400 mb-4",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("span",{children:oe(s.testDate||s.createdAt)}),s.images&&s.images.length>0&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(me,{className:"h-3 w-3"}),e.jsxs("span",{children:[s.images.length," fotos"]})]})]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(S,{to:`/quality/tests/${s.id}`,className:"inline-flex items-center px-3 py-1.5 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors",children:[e.jsx(ne,{className:"h-4 w-4 mr-1"}),"Detalhes"]}),((n==null?void 0:n.role)==="ADMIN"||(n==null?void 0:n.role)==="MANAGER"||(n==null?void 0:n.role)==="LEADER")&&e.jsxs("button",{className:"inline-flex items-center px-3 py-1.5 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors",children:[e.jsx(ce,{className:"h-4 w-4 mr-1"}),"Relatório"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("button",{className:"p-1.5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",children:e.jsx(q,{className:"h-4 w-4"})}),e.jsx("button",{className:"p-1.5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",children:e.jsx(ie,{className:"h-4 w-4"})})]})]})]})};return e.jsxs(e.Fragment,{children:[e.jsxs(de,{children:[e.jsx("title",{children:"Testes de Qualidade - Sistema ZARA"}),e.jsx("meta",{name:"description",content:"Histórico de testes de qualidade do Sistema ZARA"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(O,{children:b&&e.jsx($.div,{initial:{opacity:0,y:-50},animate:{opacity:1,y:0},exit:{opacity:0,y:-50},className:"bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-md p-4",children:e.jsxs("div",{className:"flex",children:[e.jsx(L,{className:"h-5 w-5 text-green-400"}),e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-green-600 dark:text-green-400",children:b})})]})})}),e.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Testes de Qualidade"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Histórico e resultados dos testes de qualidade"})]})}),T&&e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-3 text-gray-600 dark:text-gray-400",children:"Carregando testes..."})]}),v&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-md p-4",children:e.jsx("div",{className:"flex",children:e.jsx("div",{className:"ml-3",children:e.jsx("p",{className:"text-sm text-red-600 dark:text-red-400",children:v})})})}),!T&&!v&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsx("div",{}),e.jsx("div",{className:"mt-4 sm:mt-0",children:e.jsxs(S,{to:M.QUALITY_NEW,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 transition-colors",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Novo Teste"]})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/20 rounded-lg",children:e.jsx(P,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Total de Testes"}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:c.length})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-green-100 dark:bg-green-900/20 rounded-lg",children:e.jsx(L,{className:"h-6 w-6 text-green-600 dark:text-green-400"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Aprovados"}),e.jsx("p",{className:"text-2xl font-bold text-green-600 dark:text-green-400",children:c.filter(s=>s.overallResult==="PASS").length})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-red-100 dark:bg-red-900/20 rounded-lg",children:e.jsx(I,{className:"h-6 w-6 text-red-600 dark:text-red-400"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Reprovados"}),e.jsx("p",{className:"text-2xl font-bold text-red-600 dark:text-red-400",children:c.filter(s=>s.overallResult==="FAIL").length})]})]})}),e.jsx("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"p-2 bg-yellow-100 dark:bg-yellow-900/20 rounded-lg",children:e.jsx(q,{className:"h-6 w-6 text-yellow-600 dark:text-yellow-400"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("p",{className:"text-sm font-medium text-gray-500 dark:text-gray-400",children:"Taxa de Aprovação"}),e.jsxs("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:[c.length>0?Math.round(c.filter(s=>s.overallResult==="PASS").length/c.length*100):0,"%"]})]})]})})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center space-y-4 sm:space-y-0 sm:space-x-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(le,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar testes...",value:g,onChange:s=>Q(s.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("select",{value:y,onChange:s=>W(s.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"ALL",children:"Todos os Resultados"}),e.jsx("option",{value:"PASS",children:"Aprovados"}),e.jsx("option",{value:"FAIL",children:"Reprovados"})]}),e.jsxs("select",{value:p,onChange:s=>Y(s.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"ALL",children:"Todas as Máquinas"}),Z.map(s=>e.jsx("option",{value:s.id,children:s.name},s.id))]}),e.jsxs("select",{value:j,onChange:s=>z(s.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"TODAY",children:"Hoje"}),e.jsx("option",{value:"WEEK",children:"Esta Semana"}),e.jsx("option",{value:"MONTH",children:"Este Mês"}),e.jsx("option",{value:"ALL",children:"Todos os Períodos"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[k.length," testes"]}),e.jsxs("div",{className:u("flex items-center space-x-2 px-3 py-1 rounded-full text-xs font-medium",N?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400":"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400"),children:[e.jsx("div",{className:u("h-1.5 w-1.5 rounded-full",N?"bg-green-500":"bg-red-500")}),e.jsx("span",{children:N?"Online":"Offline"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Ordenar por:"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("select",{value:R,onChange:s=>U(s.target.value),className:"px-3 py-1 border border-gray-300 dark:border-gray-600 rounded text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"timestamp",children:"Data/Hora"}),e.jsx("option",{value:"machine",children:"Máquina"}),e.jsx("option",{value:"operator",children:"Operador"}),e.jsx("option",{value:"result",children:"Resultado"})]}),e.jsx("button",{onClick:()=>G(f==="asc"?"desc":"asc"),className:"p-1 border border-gray-300 dark:border-gray-600 rounded text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors",children:f==="asc"?"↑":"↓"})]})]})]})}),e.jsx(O,{children:e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:k.map(s=>e.jsx(X,{test:s},s.id))})}),k.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(P,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-white",children:"Nenhum teste encontrado"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Tente ajustar os filtros de busca ou criar um novo teste."}),e.jsx("div",{className:"mt-6",children:e.jsxs(S,{to:M.QUALITY_NEW,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 transition-colors",children:[e.jsx(H,{className:"h-4 w-4 mr-2"}),"Novo Teste"]})})]})]})]})]})};export{we as default};
//# sourceMappingURL=QualityTests-Dy6T33TS.js.map
