import{j as e}from"./query-B88w_-l3.js";import{r as n}from"./vendor-BKU87Gzz.js";import{a as F,L as i}from"./router-Cr3qqr-L.js";import{u as P,f as L,g as T,j as O,W as D,R as $,G as I,c as l,H as U,v as p,m as q,q as G,b as z,p as h,I as B,l as H,z as V,k as _}from"./index-DY2ZM4tI.js";import{u as W}from"./useRealTimeProduction-CQYe6__r.js";import{F as Z}from"./PlusIcon-Bk98C3yE.js";import{F as J,a as K}from"./StopIcon-CJc_mX_I.js";import"./utils-CZH8StwO.js";const ce=()=>{const[o,j]=n.useState(""),[c,N]=n.useState("ALL"),[y,k]=n.useState("name"),[x,w]=n.useState("asc"),[Q,X]=n.useState(null),[Y,ee]=n.useState(!1),{user:r}=P(),{isConnected:g}=L(),{machines:v,loading:A,error:b}=T(),{filterMachinesByPermissions:R,loading:f}=O();if(F(),A||f)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"Carregando máquinas..."})]})});if(b)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-red-500 mb-4",children:e.jsx("svg",{className:"mx-auto h-12 w-12",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.268 15.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 dark:text-white mb-2",children:"Erro ao carregar máquinas"}),e.jsx("p",{className:"text-gray-600 dark:text-gray-400 mb-4",children:b}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors",children:"Tentar novamente"})]})});const m=(f?[]:R(v||[],"canView")).filter(t=>{const s=t.name.toLowerCase().includes(o.toLowerCase())||t.id.toLowerCase().includes(o.toLowerCase())||t.location.toLowerCase().includes(o.toLowerCase()),d=c==="ALL"||t.status===c;return s&&d}).sort((t,s)=>{let d,a;switch(y){case"name":d=t.name,a=s.name;break;case"status":d=t.status,a=s.status;break;case"efficiency":d=t.efficiency,a=s.efficiency;break;case"lastUpdate":d=t.lastUpdate,a=s.lastUpdate;break;default:return 0}return x==="asc"?d>a?1:-1:d<a?1:-1}),C=t=>{switch(t){case"FUNCIONANDO":case"RUNNING":return{label:"Funcionando",color:"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400",icon:K,iconColor:"text-green-600 dark:text-green-400"};case"PARADA":case"STOPPED":return{label:"Parada",color:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",icon:J,iconColor:"text-gray-600 dark:text-gray-400"};case"MANUTENCAO":case"MAINTENANCE":return{label:"Manutenção",color:"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-400",icon:p,iconColor:"text-yellow-600 dark:text-yellow-400"};case"ERROR":return{label:"Erro",color:"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400",icon:_,iconColor:"text-red-600 dark:text-red-400"};case"FORA_DE_TURNO":case"OFF_SHIFT":return{label:"Fora de Turno",color:"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-400",icon:h,iconColor:"text-blue-600 dark:text-blue-400"};default:return{label:"Desconhecido",color:"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300",icon:h,iconColor:"text-gray-600 dark:text-gray-400"}}},E=t=>t>=90?"text-green-600 dark:text-green-400":t>=80?"text-yellow-600 dark:text-yellow-400":"text-red-600 dark:text-red-400",M=t=>{switch(t){case"error":return"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400";case"warning":return"bg-yellow-100 text-yellow-800 dark:bg-yellow-900/20 dark:text-yellow-400";case"info":return"bg-blue-100 text-blue-800 dark:bg-blue-900/20 dark:text-blue-400";default:return"bg-gray-100 text-gray-800 dark:bg-gray-700 dark:text-gray-300"}},S=({machine:t})=>{const s=C(t.status),d=s.icon,a=W(t);return e.jsxs(q.div,{layout:!0,initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},whileHover:{scale:1.02},className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 hover:shadow-md transition-shadow",children:[e.jsxs("div",{className:"flex items-start justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:l("p-2 rounded-lg",t.status==="FUNCIONANDO"?"bg-green-100 dark:bg-green-900/20":t.status==="ERROR"?"bg-red-100 dark:bg-red-900/20":t.status==="MAINTENANCE"?"bg-yellow-100 dark:bg-yellow-900/20":"bg-gray-100 dark:bg-gray-700"),children:e.jsx(d,{className:l("h-6 w-6",s.iconColor)})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:t.name}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[t.id," • ",t.model]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("span",{className:l("inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium",s.color),children:s.label}),t.alerts&&t.alerts.length>0&&e.jsx("span",{className:"inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400",children:t.alerts.length})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Localização"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.location})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Operador"}),e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.operator})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Eficiência"}),e.jsxs("p",{className:l("text-lg font-bold",E(a.efficiency)),children:[a.efficiency,"%"]}),e.jsx("div",{className:"text-xs text-gray-500 mt-1",children:a.isRunning?"Em Operação":"Parada"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:"Produção Atual"}),e.jsxs("p",{className:"text-lg font-bold text-gray-900 dark:text-white",children:[Math.floor(a.currentProduction||0).toLocaleString(),e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400 font-normal",children:["/",(a.targetProduction||0).toLocaleString()]})]}),e.jsx("div",{className:"text-xs text-green-600 mt-1",children:a.isRunning?`+${a.currentSpeed}/min`:"Velocidade: 0/min"})]})]}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400 mb-1",children:[e.jsx("span",{children:"Meta de Produção (Turno Atual)"}),e.jsxs("span",{children:[Math.round((a.currentProduction||0)/(a.targetProduction||1)*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:l("h-2 rounded-full transition-all duration-300",(a.currentProduction||0)>=(a.targetProduction||1)?"bg-green-500":(a.currentProduction||0)>=(a.targetProduction||1)*.8?"bg-yellow-500":"bg-red-500"),style:{width:`${Math.min((a.currentProduction||0)/(a.targetProduction||1)*100,100)}%`}})}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400 mt-1",children:[e.jsxs("span",{children:["Tempo ativo: ",a.formattedRunningTime]}),e.jsxs("span",{children:["Última atualização: ",new Date().toLocaleTimeString("pt-BR")]})]})]}),t.alerts&&t.alerts.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm font-medium text-gray-900 dark:text-white mb-2",children:"Alertas Ativos"}),e.jsxs("div",{className:"space-y-1",children:[t.alerts.slice(0,2).map(u=>e.jsx("div",{className:l("px-2 py-1 rounded text-xs",M(u.severity)),children:u.message},u.id)),t.alerts.length>2&&e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:["+",t.alerts.length-2," mais alertas"]})]})]}),e.jsx("div",{className:"flex items-center justify-between text-xs text-gray-500 dark:text-gray-400 mb-4",children:e.jsxs("span",{children:["Última atualização: ",G(t.updatedAt||t.lastUpdate)]})}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(i,{to:`/machines/${t.id}`,className:"inline-flex items-center px-3 py-1.5 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors",children:[e.jsx(z,{className:"h-4 w-4 mr-1"}),"Detalhes"]}),((r==null?void 0:r.role)==="OPERATOR"||(r==null?void 0:r.role)==="LEADER"||(r==null?void 0:r.role)==="MANAGER"||(r==null?void 0:r.role)==="ADMIN")&&e.jsxs(i,{to:`/machines/${t.id}/status`,className:"inline-flex items-center px-3 py-1.5 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors",children:[e.jsx(h,{className:"h-4 w-4 mr-1"}),"Status"]}),((r==null?void 0:r.role)==="ADMIN"||(r==null?void 0:r.role)==="MANAGER"||(r==null?void 0:r.role)==="LEADER")&&e.jsxs(i,{to:`/machines/${t.id}/config`,className:"inline-flex items-center px-3 py-1.5 border border-gray-300 dark:border-gray-600 text-sm font-medium rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors",children:[e.jsx(B,{className:"h-4 w-4 mr-1"}),"Configurar"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("button",{className:"p-1.5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",children:e.jsx(H,{className:"h-4 w-4"})}),e.jsx("button",{className:"p-1.5 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors",children:e.jsx(V,{className:"h-4 w-4"})})]})]})]})};return e.jsxs(e.Fragment,{children:[e.jsxs(D,{children:[e.jsx("title",{children:"Máquinas - Sistema ZARA"}),e.jsx("meta",{name:"description",content:"Gerenciamento de máquinas do Sistema ZARA"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Máquinas"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Monitore o status e desempenho de todas as máquinas"})]}),((r==null?void 0:r.role)==="ADMIN"||(r==null?void 0:r.role)==="MANAGER")&&e.jsx("div",{className:"mt-4 sm:mt-0",children:e.jsxs(i,{to:$.MACHINE_NEW,className:"inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-blue-600 hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600 transition-colors",children:[e.jsx(Z,{className:"h-4 w-4 mr-2"}),"Nova Máquina"]})})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 p-4 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between space-y-4 sm:space-y-0",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center space-y-4 sm:space-y-0 sm:space-x-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx(I,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar máquinas...",value:o,onChange:t=>j(t.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400 focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),e.jsxs("select",{value:c,onChange:t=>N(t.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"ALL",children:"Todos os Status"}),e.jsx("option",{value:"RUNNING",children:"Funcionando"}),e.jsx("option",{value:"STOPPED",children:"Paradas"}),e.jsx("option",{value:"MAINTENANCE",children:"Manutenção"}),e.jsx("option",{value:"ERROR",children:"Erro"})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("select",{value:y,onChange:t=>k(t.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[e.jsx("option",{value:"name",children:"Nome"}),e.jsx("option",{value:"status",children:"Status"}),e.jsx("option",{value:"efficiency",children:"Eficiência"}),e.jsx("option",{value:"lastUpdate",children:"Última Atualização"})]}),e.jsx("button",{onClick:()=>w(x==="asc"?"desc":"asc"),className:"p-2 border border-gray-300 dark:border-gray-600 rounded-md text-gray-700 dark:text-gray-300 bg-white dark:bg-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600 transition-colors",children:x==="asc"?"↑":"↓"})]})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:[m.length," máquinas"]}),e.jsxs("div",{className:l("flex items-center space-x-2 px-3 py-1 rounded-full text-xs font-medium",g?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400":"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400"),children:[e.jsx("div",{className:l("h-1.5 w-1.5 rounded-full",g?"bg-green-500":"bg-red-500")}),e.jsx("span",{children:g?"Online":"Offline"})]})]})]})}),e.jsx(U,{children:e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6",children:m.map(t=>e.jsx(S,{machine:t},t.id))})}),m.length===0&&e.jsxs("div",{className:"text-center py-12",children:[e.jsx(p,{className:"mx-auto h-12 w-12 text-gray-400"}),e.jsx("h3",{className:"mt-2 text-sm font-medium text-gray-900 dark:text-white",children:"Nenhuma máquina encontrada"}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Tente ajustar os filtros de busca."})]})]})]})};export{ce as default};
//# sourceMappingURL=Machines-BL6IME4e.js.map
