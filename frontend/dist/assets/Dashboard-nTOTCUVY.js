import{j as e}from"./query-B88w_-l3.js";import{r as l}from"./vendor-BKU87Gzz.js";import{L as u}from"./router-Cr3qqr-L.js";import{u as se,f as ae,g as ne,h as de,j as le,W as ce,c as i,k as O,l as V,n as _,o as ie,p as L,R as f,b as oe,q as xe,r as U,m as me,s as ge,t as ue,v as he,w as je}from"./index-DY2ZM4tI.js";import{F as be}from"./PlusIcon-Bk98C3yE.js";import"./utils-CZH8StwO.js";const Ae=()=>{var R,E,A,M,T,S,F,P,$,I,q;const[h,G]=l.useState("today"),[pe,fe]=l.useState("production"),{user:d}=se(),{isConnected:j}=ae(),{machines:x,stats:a}=ne(),{notifications:H}=de(),{filterMachinesByPermissions:Q}=le(),[B,y]=l.useState({totalProduction:0,totalRunningTime:0,averageEfficiency:0,totalDowntime:0}),N=async()=>{try{const r=await U.get("/machines/production/aggregate");r.data.success&&y(r.data.data)}catch(r){if(console.error("Erro ao buscar dados agregados:",r),x&&x.length>0){const n=Q(x,"canView"),s=n.filter(o=>o.status==="FUNCIONANDO"||o.status==="RUNNING");y({totalProduction:s.length*100,totalRunningTime:s.length*60,averageEfficiency:s.length>0?85:0,totalDowntime:(n.length-s.length)*30})}}};l.useEffect(()=>{N();const r=setInterval(N,3e4);return()=>clearInterval(r)},[x]);const c=B,[t,W]=l.useState(null),[v,w]=l.useState(!0),[b,k]=l.useState(null),[Z,Y]=l.useState([]),m={total:(a==null?void 0:a.total)||12,running:(a==null?void 0:a.running)||8,stopped:(a==null?void 0:a.stopped)||2,maintenance:(a==null?void 0:a.maintenance)||1,error:(a==null?void 0:a.error)||1};(H||[]).slice(0,5);const z=async()=>{var r,n;try{w(!0),k(null);const s=await U.get(`/reports/dashboard?timeRange=${h}`);if(s.data.success)W(s.data.data),Y(s.data.data.recentActivities||[]);else throw new Error(s.data.message||"Erro ao carregar dados")}catch(s){console.error("Erro ao buscar dados do dashboard:",s),k(((n=(r=s.response)==null?void 0:r.data)==null?void 0:n.message)||s.message||"Erro ao carregar dados do dashboard")}finally{w(!1)}};l.useEffect(()=>{z()},[h]);const J=r=>{switch(r){case"quality_test":return _;case"machine_stop":case"teflon_change":return he;case"quality_alert":return O;default:return L}},K=r=>{switch(r){case"success":return"text-green-600 bg-green-100 dark:bg-green-900/20 dark:text-green-400";case"warning":return"text-yellow-600 bg-yellow-100 dark:bg-yellow-900/20 dark:text-yellow-400";case"error":return"text-red-600 bg-red-100 dark:bg-red-900/20 dark:text-red-400";default:return"text-blue-600 bg-blue-100 dark:bg-blue-900/20 dark:text-blue-400"}},g=({title:r,value:n,target:s,change:o,trend:X,icon:D,unit:ee="",format:te="number"})=>{const re=X==="up"?ge:ue,C=p=>{switch(te){case"percentage":return`${p}%`;case"time":return`${p}min`;default:return je(p)+ee}};return e.jsxs(me.div,{whileHover:{scale:1.02},className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-100 dark:bg-blue-900/20 rounded-lg",children:e.jsx(D,{className:"h-6 w-6 text-blue-600 dark:text-blue-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 dark:text-gray-400",children:r}),e.jsx("p",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:C(n)})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("div",{className:i("flex items-center space-x-1 text-sm font-medium",o>0?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:[e.jsx(re,{className:"h-4 w-4"}),e.jsxs("span",{children:[Math.abs(o),"%"]})]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Meta: ",C(s)]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsxs("div",{className:"flex justify-between text-xs text-gray-500 dark:text-gray-400 mb-1",children:[e.jsx("span",{children:"Progresso"}),e.jsxs("span",{children:[Math.round(n/s*100),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:i("h-2 rounded-full transition-all duration-300",n>=s?"bg-green-500":n>=s*.8?"bg-yellow-500":"bg-red-500"),style:{width:`${Math.min(n/s*100,100)}%`}})})]})]})};return e.jsxs(e.Fragment,{children:[e.jsxs(ce,{children:[e.jsx("title",{children:"Dashboard - Sistema ZARA"}),e.jsx("meta",{name:"description",content:"Dashboard principal do Sistema ZARA"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:"Dashboard"}),e.jsxs("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:["Bem-vindo de volta, ",d==null?void 0:d.name,"! Aqui está um resumo das operações."]})]}),e.jsxs("div",{className:"mt-4 sm:mt-0 flex items-center space-x-3",children:[e.jsxs("select",{value:h,onChange:r=>G(r.target.value),className:"px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md text-sm bg-white dark:bg-gray-700 text-gray-900 dark:text-white",children:[e.jsx("option",{value:"today",children:"Hoje"}),e.jsx("option",{value:"week",children:"Esta Semana"}),e.jsx("option",{value:"month",children:"Este Mês"})]}),e.jsxs("div",{className:i("flex items-center space-x-2 px-3 py-2 rounded-md text-sm font-medium",j?"bg-green-100 text-green-800 dark:bg-green-900/20 dark:text-green-400":"bg-red-100 text-red-800 dark:bg-red-900/20 dark:text-red-400"),children:[e.jsx("div",{className:i("h-2 w-2 rounded-full",j?"bg-green-500":"bg-red-500")}),e.jsx("span",{children:j?"Online":"Offline"})]})]})]}),v&&e.jsxs("div",{className:"flex justify-center items-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"}),e.jsx("span",{className:"ml-2 text-gray-600 dark:text-gray-400",children:"Carregando dados..."})]}),b&&e.jsx("div",{className:"bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(O,{className:"h-5 w-5 text-red-400 mr-2"}),e.jsxs("p",{className:"text-red-800 dark:text-red-400",children:["Erro ao carregar dados: ",b]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[e.jsx(g,{title:"Produção Total",value:c.totalProduction,target:((R=t==null?void 0:t.production)==null?void 0:R.target)||1e4,change:((E=t==null?void 0:t.production)==null?void 0:E.change)||5,trend:c.totalProduction>(((A=t==null?void 0:t.production)==null?void 0:A.target)||1e4)*.8?"up":"down",icon:V,unit:" pcs"}),e.jsx(g,{title:"Taxa de Qualidade",value:((M=t==null?void 0:t.quality)==null?void 0:M.passRate)||95,target:((T=t==null?void 0:t.quality)==null?void 0:T.target)||98,change:((S=t==null?void 0:t.quality)==null?void 0:S.change)||2,trend:((F=t==null?void 0:t.quality)==null?void 0:F.trend)||"up",icon:_,format:"percentage"}),e.jsx(g,{title:"Eficiência Geral",value:Math.round(c.averageEfficiency),target:((P=t==null?void 0:t.efficiency)==null?void 0:P.target)||90,change:(($=t==null?void 0:t.efficiency)==null?void 0:$.change)||3,trend:c.averageEfficiency>=80?"up":"down",icon:ie,format:"percentage"}),e.jsx(g,{title:"Tempo de Parada",value:Math.round(c.totalDowntime),target:((I=t==null?void 0:t.downtime)==null?void 0:I.target)||120,change:((q=t==null?void 0:t.downtime)==null?void 0:q.change)||-10,trend:c.totalDowntime<120?"up":"down",icon:L,format:"time"})]}),!v&&!b&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Status das Máquinas"}),e.jsxs(u,{to:f.MACHINES,className:"text-sm text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 flex items-center space-x-1",children:[e.jsx("span",{children:"Ver todas"}),e.jsx(oe,{className:"h-4 w-4"})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"text-center p-4 bg-green-50 dark:bg-green-900/20 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-700 dark:text-green-300",children:m.running}),e.jsx("div",{className:"text-sm text-green-600 dark:text-green-400",children:"Funcionando"})]}),e.jsxs("div",{className:"text-center p-4 bg-gray-50 dark:bg-gray-700/50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-gray-700 dark:text-gray-300",children:m.stopped}),e.jsx("div",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Paradas"})]}),e.jsxs("div",{className:"text-center p-4 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-yellow-700 dark:text-yellow-300",children:m.maintenance}),e.jsx("div",{className:"text-sm text-yellow-600 dark:text-yellow-400",children:"Manutenção"})]}),e.jsxs("div",{className:"text-center p-4 bg-red-50 dark:bg-red-900/20 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-red-700 dark:text-red-300",children:m.error}),e.jsx("div",{className:"text-sm text-red-600 dark:text-red-400",children:"Erro"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("div",{className:"flex items-center justify-between text-sm",children:e.jsx("span",{className:"text-gray-600 dark:text-gray-400",children:"Eficiência por Turno"})}),e.jsx("div",{className:"space-y-2",children:[{name:"Turno 1",value:92,color:"bg-green-500"},{name:"Turno 2",value:87,color:"bg-yellow-500"},{name:"Turno 3",value:83,color:"bg-red-500"}].map(r=>e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-16 text-sm text-gray-600 dark:text-gray-400",children:r.name}),e.jsx("div",{className:"flex-1 bg-gray-200 dark:bg-gray-700 rounded-full h-2",children:e.jsx("div",{className:i("h-2 rounded-full",r.color),style:{width:`${r.value}%`}})}),e.jsxs("div",{className:"w-12 text-sm font-medium text-gray-900 dark:text-white",children:[r.value,"%"]})]},r.name))})]})]})}),e.jsx("div",{children:e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-6 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 dark:text-white",children:"Atividades Recentes"}),e.jsx(u,{to:"/activities",className:"text-sm text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300",children:"Ver todas"})]}),e.jsx("div",{className:"space-y-4",children:Z.map(r=>{const n=J(r.type);return e.jsxs("div",{className:"flex items-start space-x-3",children:[e.jsx("div",{className:i("flex-shrink-0 p-2 rounded-lg",K(r.status)),children:e.jsx(n,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm text-gray-900 dark:text-white",children:r.message}),e.jsxs("div",{className:"flex items-center space-x-2 mt-1",children:[e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:r.user}),e.jsx("span",{className:"text-xs text-gray-400",children:"•"}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400",children:xe(r.timestamp)})]})]})]},r.id)})}),e.jsxs("div",{className:"mt-6 pt-6 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 dark:text-white mb-3",children:"Ações Rápidas"}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(u,{to:f.QUALITY_NEW,className:"flex items-center space-x-2 p-2 text-sm text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-md transition-colors",children:[e.jsx(be,{className:"h-4 w-4"}),e.jsx("span",{children:"Novo Teste de Qualidade"})]}),((d==null?void 0:d.role)==="ADMIN"||(d==null?void 0:d.role)==="MANAGER")&&e.jsxs(u,{to:f.REPORTS,className:"flex items-center space-x-2 p-2 text-sm text-blue-600 hover:text-blue-700 dark:text-blue-400 dark:hover:text-blue-300 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded-md transition-colors",children:[e.jsx(V,{className:"h-4 w-4"}),e.jsx("span",{children:"Ver Relatórios"})]})]})]})]})})]})]})]})};export{Ae as default};
//# sourceMappingURL=Dashboard-nTOTCUVY.js.map
