import{j as e}from"./query-B88w_-l3.js";import{r as o}from"./vendor-BKU87Gzz.js";import{u as q,f as U,r as h,k as y,W as z,m as b,v as P,O as H,e as _,K as W}from"./index-DY2ZM4tI.js";import{c as B,a as L}from"./router-Cr3qqr-L.js";import{F as Z}from"./ArrowLeftIcon-DeKPabn9.js";import"./utils-CZH8StwO.js";const ee=()=>{const{id:d}=B(),p=L(),{user:G}=q(),{socket:i}=U(),[t,f]=o.useState(null),x={FUNCIONANDO:"Funcionando",PARADA:"Parada",MANUTENCAO:"ManutenÃ§Ã£o",FORA_DE_TURNO:"Fora de Turno",OFF_SHIFT:"Fora de Turno"},[$,j]=o.useState(!0),[N,k]=o.useState(null),[l,v]=o.useState(""),[w,S]=o.useState(""),[A,C]=o.useState(""),[F,O]=o.useState(!1),[M,I]=o.useState([]);o.useEffect(()=>{m(),c()},[d]),o.useEffect(()=>{if(!i)return;const a=r=>{console.log("ðŸ”„ Status alterado via WebSocket na pÃ¡gina:",r),r.machineId===parseInt(d)&&(f(g=>g&&{...g,status:r.newStatus||r.status,lastUpdatedBy:r.user,updatedAt:new Date().toISOString()}),c())},s=r=>{r.machineId===parseInt(d)&&(console.log("ðŸš€ OperaÃ§Ã£o iniciada via WebSocket:",r),m(),c())},n=r=>{r.machineId===parseInt(d)&&(console.log("ðŸ›‘ OperaÃ§Ã£o finalizada via WebSocket:",r),m(),c())};return i.on("machine:status:changed",a),i.on("machine:operation-started",s),i.on("machine:operation-ended",n),()=>{i.off("machine:status:changed",a),i.off("machine:operation-started",s),i.off("machine:operation-ended",n)}},[i,d]);const m=async()=>{try{j(!0);const a=await h.get(`/machines/${d}`);f(a.data),v(a.data.status)}catch(a){console.error("Erro ao carregar dados da mÃ¡quina:",a),k("Erro ao carregar dados da mÃ¡quina")}finally{j(!1)}},c=async()=>{try{const a=await h.get(`/machines/${d}/status-history`);I(a.data)}catch(a){console.error("Erro ao carregar histÃ³rico de status:",a)}},T=async a=>{if(a.preventDefault(),!l)return;const s={Funcionando:"FUNCIONANDO",Parada:"PARADA",ManutenÃ§Ã£o:"MANUTENCAO","Fora de Turno":"FORA_DE_TURNO"};O(!0);try{await h.put(`/machines/${d}/status`,{status:s[l]||l,reason:w,notes:A}),await m(),await c(),S(""),C(""),W.success("Status atualizado com sucesso!")}catch(n){console.error("Erro ao atualizar status:",n),k("Erro ao atualizar status da mÃ¡quina")}finally{O(!1)}},E=a=>{const s=x[a]||a;return{Funcionando:{color:"text-green-600 dark:text-green-400",bgColor:"bg-green-100 dark:bg-green-900/20",borderColor:"border-green-200 dark:border-green-800",icon:_},Parada:{color:"text-red-600 dark:text-red-400",bgColor:"bg-red-100 dark:bg-red-900/20",borderColor:"border-red-200 dark:border-red-800",icon:H},ManutenÃ§Ã£o:{color:"text-yellow-600 dark:text-yellow-400",bgColor:"bg-yellow-100 dark:bg-yellow-900/20",borderColor:"border-yellow-200 dark:border-yellow-800",icon:P}}[s]||{color:"text-gray-600 dark:text-gray-400",bgColor:"bg-gray-100 dark:bg-gray-700",borderColor:"border-gray-200 dark:border-gray-600",icon:y}},R=a=>{if(!a)return"NÃ£o disponÃ­vel";const s=new Date(a);return isNaN(s.getTime())?"Data invÃ¡lida":s.toLocaleString("pt-BR")};if($)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-600"})});if(N)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx(y,{className:"h-12 w-12 text-red-500 mx-auto mb-4"}),e.jsx("p",{className:"text-red-600 dark:text-red-400",children:N}),e.jsx("button",{onClick:()=>p("/machines"),className:"mt-4 px-4 py-2 bg-blue-600 text-white font-medium rounded-lg hover:bg-blue-700 transition-colors duration-200",children:"Voltar para MÃ¡quinas"})]})});if(!t)return e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx("p",{className:"text-gray-600 dark:text-gray-400",children:"MÃ¡quina nÃ£o encontrada"})});const u=E(t.status),D=u.icon;return e.jsxs(e.Fragment,{children:[e.jsxs(z,{children:[e.jsx("title",{children:t?`Status - ${t.name} - Sistema ZARA`:"Status da MÃ¡quina - Sistema ZARA"}),e.jsx("meta",{name:"description",content:t?`Controle de status da mÃ¡quina ${t.name}`:"Controle de status da mÃ¡quina"})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("button",{onClick:()=>p("/machines"),className:"p-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors duration-200 rounded-lg",children:e.jsx(Z,{className:"h-6 w-6"})}),e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-900 dark:text-white",children:["Controle de Status - ",t.name]}),e.jsx("p",{className:"mt-1 text-sm text-gray-500 dark:text-gray-400",children:"Gerencie o status operacional da mÃ¡quina"})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Status Atual"}),e.jsxs("div",{className:`flex items-center space-x-3 p-4 rounded-lg ${u.bgColor} ${u.borderColor} border`,children:[e.jsx(D,{className:`h-8 w-8 ${u.color}`}),e.jsxs("div",{children:[e.jsx("p",{className:`text-lg font-semibold ${u.color}`,children:x[t.status]||t.status}),e.jsxs("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:["Ãšltima atualizaÃ§Ã£o: ",t.updatedAt?R(t.updatedAt):"NÃ£o disponÃ­vel"]})]})]}),e.jsxs("div",{className:"mt-6 space-y-3",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"LocalizaÃ§Ã£o:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.location})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Tipo:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.type})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:"Operador:"}),e.jsx("span",{className:"text-sm font-medium text-gray-900 dark:text-white",children:t.currentOperator||"NÃ£o atribuÃ­do"})]})]}),t.alerts&&t.alerts.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("h3",{className:"text-sm font-medium text-gray-900 dark:text-white mb-2",children:["Alertas Ativos (",t.alerts.length,")"]}),e.jsx("div",{className:"space-y-2",children:t.alerts.map((a,s)=>e.jsxs("div",{className:"flex items-start space-x-2 p-2 bg-red-50 dark:bg-red-900/20 rounded",children:[e.jsx(y,{className:"h-4 w-4 text-red-500 mt-0.5"}),e.jsx("p",{className:"text-sm text-red-700 dark:text-red-300",children:a.message})]},s))})]})]}),e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.1},className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"Alterar Status"}),e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Novo Status"}),e.jsxs("select",{value:l,onChange:a=>v(a.target.value),className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white",required:!0,children:[e.jsx("option",{value:"Funcionando",children:"Funcionando"}),e.jsx("option",{value:"Parada",children:"Parada"}),e.jsx("option",{value:"ManutenÃ§Ã£o",children:"ManutenÃ§Ã£o"}),e.jsx("option",{value:"Fora de Turno",children:"Fora de Turno"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Motivo da AlteraÃ§Ã£o"}),e.jsx("input",{type:"text",value:w,onChange:a=>S(a.target.value),placeholder:"Ex: ManutenÃ§Ã£o preventiva, falha no equipamento...",className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"ObservaÃ§Ãµes Adicionais"}),e.jsx("textarea",{value:A,onChange:a=>C(a.target.value),placeholder:"InformaÃ§Ãµes adicionais sobre a alteraÃ§Ã£o de status...",rows:4,className:"w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 dark:bg-gray-700 dark:text-white"})]}),e.jsx("button",{type:"submit",disabled:F||!l,className:"w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors duration-200 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center",children:F?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Atualizando..."]}):"Atualizar Status"})]})]})]}),e.jsxs(b.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:.2},className:"bg-white dark:bg-gray-800 rounded-lg shadow-sm border border-gray-200 dark:border-gray-700 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 dark:text-white mb-4",children:"HistÃ³rico de Status"}),M.length>0?e.jsx("div",{className:"space-y-3",children:M.map((a,s)=>{const n=E(a.status),r=n.icon;return e.jsxs("div",{className:"flex items-start space-x-3 p-3 border border-gray-200 dark:border-gray-700 rounded-lg",children:[e.jsx(r,{className:`h-5 w-5 ${n.color} mt-0.5`}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:`font-medium ${n.color}`,children:x[a.status]||a.status}),e.jsx("span",{className:"text-sm text-gray-500 dark:text-gray-400",children:R(a.timestamp)})]}),a.reason&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:["Motivo: ",a.reason]}),a.notes&&e.jsxs("p",{className:"text-sm text-gray-600 dark:text-gray-400 mt-1",children:["ObservaÃ§Ãµes: ",a.notes]}),e.jsxs("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-1",children:["Por: ",a.changedBy||"Sistema"]})]})]},s)})}):e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-center py-8",children:"Nenhum histÃ³rico de status disponÃ­vel"})]})]})]})};export{ee as default};
//# sourceMappingURL=MachineStatus-Cuq-NnSe.js.map
